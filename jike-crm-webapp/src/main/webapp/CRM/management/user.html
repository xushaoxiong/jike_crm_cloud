<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>账户管理</title>
	<!--<link rel="stylesheet" href="../css/bootstrap.min.css" />-->
	<link rel="stylesheet" href="js/scrollbar/css/jquery.mCustomScrollbar.min.css" />
	<!--<script type="text/javascript" src="../js/jquery-1.11.0.js" ></script>
	<script type="text/javascript" src="../js/pub/pub.js" ></script>-->
	<script type="text/javascript" src="js/scrollbar/js/jquery.mousewheel.min.js" ></script>
	<script type="text/javascript" src="js/scrollbar/js/jquery.mCustomScrollbar.js" ></script>
	<!--<script type="text/javascript" src="js/myDate/My97DatePicker/WdatePicker.js" ></script>-->
	<!--<script type="text/javascript" src="../js/bootstrap.min.js" ></script>-->
	<script type="text/javascript" src="js/bootstrap-paginator.js" ></script>
	<!--<script type="text/javascript" src="js/management/user.js" ></script>-->
</head>
<body>
	<style>
	.ZH-account button{
		margin-top: 20px;
	}
	.search-wap{
		padding: 20px 0;
	}
	.tableAccnt tr th{text-align: center;}
	.pagination-wap{
		line-height: 80px;
	}
	.total-page{
		padding-right: 15px;
	}
	.table tr td a{cursor: pointer;padding: 0 5px;}
	#newAdd .form-group{display: block;margin-bottom: 8px;}
	#newAdd label{
		width: 30% !important;
		text-align: right;
	}
</style>
<div class="wapper">
	<div class="ZH-account clearfix" style="width: 95%;">
	<h3 class="title pull-left">账户管理</h3>
	<button class="btn btn-primary pull-right addBtn"><span class="glyphicon glyphicon-plus"></span>新增账户</button>
</div>
<div class="search-wap form-inline clearfix">
	<!--<div class="form-group">
		<label>用户名：</label>
		<input type="text" class="form-control" placeholder="用户名"/>
	</div>-->
	<div class="form-group">
		<label>员工姓名：</label>
		<input type="text" class="form-control userName" placeholder="员工姓名"/>
	</div>
	<button class="btn btn-default userSearch">
		<span class="glyphicon glyphicon-search"></span>
	</button>
</div>
<table class="table table-bordered text-center table-responsive tableAccnt">
	<thead>
		<tr>
			<th>用户名</th>
			<th>员工姓名</th>
			<th>性别</th>
			<th>手机号</th>
			<th>邮箱</th>
			<th>工号</th>
			<th>是否在职</th>
			<th>入职日期</th>
			<th>角色分配</th>
			<th>操作</th>
		</tr>
	</thead>
	<tbody class="userList">

		
	</tbody>
</table>
<!--分页-->
<div class="pagination-wap">
	<div class="total-page pull-left">
		<span class="totalPage"></span>
		<span class="totalNum"></span>
	</div>
	<ul class="pagination">
	</ul> 
</div>
<!--新增弹框-->
<div class="modal " id="newAdd">
	<div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">新增账户</h4>
            </div>
            <div class="modal-body form-inline">
            	<p class="text-danger text-center userModalAlt"></p>
                <div class="form-group AccountInp-wap">
                	<label>登录名：</label>
                	<input type="text" value="登录名" class="form-control AccountInp"/>
                </div>
                <div class="form-group">
                	<label>员工姓名：</label>
                	<input type="text" value="姓名" class="form-control NameInp" />
                </div>
                <div class="form-group password-wap">
                	<label>密码：</label>
                	<input type="password" value="密码" class="form-control PwdInp" />
                </div>
                <div class="form-group genderGroup">
                	<label>性别：</label>
                	<input type="radio" gid="1" value="option1" name="optionsRadios" checked/>男
                	<input type="radio" gid="0" value="option0" name="optionsRadios"/>女
                </div>
                <div class="form-group">
                	<label>手机号：</label>
                	<input type="tel" class="form-control phoneInp" placeholder="手机号" />
                </div>
                <div class="form-group">
                	<label>邮箱：</label>
                	<input type="text" class="form-control emailInp" placeholder="邮箱" />
                </div>
                <div class="form-group">
                	<label>工号：</label>
                	<input type="text" class="form-control eplyeNumInp" placeholder="工号" />
                </div>
                <div class="form-group" id="workStats" style="display: none;">
                	<label>是否在职：</label>
                	<input type="radio" epid="0" value="option1" name="isEplment"/>在职
                	<input type="radio" epid="1" value="option0" name="isEplment"/>离职
                	
                </div>
                <div class="form-group">
                	<label>入职日期：</label>
                	<div class='input-group'>  
                		<p class="datep">
                			<input type="text" class="form-control" id="indate" data-format="dd-mm-yyyy" onclick="WdatePicker()" value="" style="width:120px; padding:5px 34px 5px 10px">
                		</p>
            		</div>  
                </div>
                <div class="form-group">
                	<label>权限组名称：</label>
                	<select class="form-control RoleInp">
                	</select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary userConfirm">保存</button>
            </div>
        </div>
    </div>
</div>
</div>
<script>
	$('.alert-del-wap').height($(window).height());
	//初始用户列表
	//设置每页数量开始页
	var paginatorJ={"name":"","start":1,"pageSize":10};	
	function userpage(){
		
		$.ajax({
		type:"post",
		contentType: "application/json; charset=utf-8",
		url:ajaxUrl+'user/getUserByPage',
		data:JSON.stringify(paginatorJ),
		dataType:'json',
		success:function(jo){
			console.log(jo)
			if(jo.userList.length==0){
				$('.userList').html('无数据');
			}
			//分页
			var options={
				alignment:"center",
		        bootstrapMajorVersion:1,    //版本
		        numberOfPages:9,    //最多显示Page页
		        totalPages:jo.totalPage,    //所有数据可以显示的页数
		        onPageClicked:function(e,originalEvent,type,page){//点击跳转页
			      	paginatorJ.start=page;
			      	clickPage(paginatorJ)
// 					userpage()
		        },
		        currentPage:paginatorJ.start,    //当前页数
		        pageUrl:function(type, page, current){
		        	 
		        }        
		    }
		    $(".pagination").bootstrapPaginator(options);
			$('.totalPage').html('共'+jo.totalCount+'条');
			$('.totalNum').html(jo.totalPage+'页');
			var userHtml='';
			$.each(jo.userList,function(i,item){
				userHtml+='<tr>';
				userHtml+='<td class="loginName">'+item.loginName+'</td>';
				userHtml+='<td class="Name">'+item.name+'</td>';
				if(item.gender=='男'){
					userHtml+='<td class="gender" gid="1">'+item.gender+'</td>';
				}else{
					userHtml+='<td class="gender" gid="0">'+item.gender+'</td>';
				}
				userHtml+='<td class="phone">'+item.phone+'</td>';
				userHtml+='<td class="email">'+item.email+'</td>';
				userHtml+='<td class="employeeNum">'+item.employeeNum+'</td>';
				if(item.isEmployment=='在职'){
					userHtml+='<td class="isEmployment" epid="0">'+item.isEmployment+'</td>';
				}else{
					userHtml+='<td class="isEmployment" epid="1">'+item.isEmployment+'</td>';
				}				
				userHtml+='<td class="entryDate">'+item.entryDate+'</td>';
				userHtml+='<td class="roleId" roleid="'+item.roleId+'">'+item.roleName+'</td>';
				userHtml+='<td>';
					userHtml+='<a class="userAmend">修改</a>';
				userHtml+='</td>';
			userHtml+='</tr>';
			})
		$('.userList').html(userHtml);
		}
	});
	}userpage();
	
	
	//点击跳转页
	function clickPage(PJson){
		$.ajax({
		type:"post",
		contentType: "application/json; charset=utf-8",
		url:ajaxUrl+'user/getUserByPage',
		data:JSON.stringify(PJson),
		dataType:'json',
		success:function(jo){
			console.log(jo)
			var userHtml='';
			$.each(jo.userList,function(i,item){
				userHtml+='<tr>';
				userHtml+='<td class="loginName">'+item.loginName+'</td>';
				userHtml+='<td class="Name">'+item.name+'</td>';
				if(item.gender=='男'){
					userHtml+='<td class="gender" gid="1">'+item.gender+'</td>';
				}else{
					userHtml+='<td class="gender" gid="0">'+item.gender+'</td>';
				}
				
				userHtml+='<td class="phone">'+item.phone+'</td>';
				userHtml+='<td class="email">'+item.email+'</td>';
				userHtml+='<td class="employeeNum">'+item.employeeNum+'</td>';
				if(item.isEmployment=='在职'){
					userHtml+='<td class="isEmployment" epid="0">'+item.isEmployment+'</td>';
				}else{
					userHtml+='<td class="isEmployment" epid="1">'+item.isEmployment+'</td>';
				}				
				userHtml+='<td class="entryDate">'+item.entryDate+'</td>';
				userHtml+='<td class="roleId" roleid="'+item.roleId+'">'+item.roleName+'</td>';
				userHtml+='<td>';
					userHtml+='<a class="userAmend">修改</a>';
				userHtml+='</td>';
			userHtml+='</tr>';
			})
		$('.userList').html(userHtml);
		}
	});
	}
	
	//搜索
	
	$('.userSearch').click(function(){
		var nameVal=$.trim($('.userName').val());
		paginatorJ.name=nameVal;
		userpage()
	})
	
	//新增
	 $(".addBtn").click(function(){
	 	$('.userModalAlt').html('');
      	$("#newAdd").modal("toggle");
      	$('.AccountInp-wap,.password-wap').show();
      	$('#workStats').hide();
      	$('.userConfirm').attr('id','addUserCofirm');
      	$("#newAdd").find('input').val('');
		//角色列表
		$.ajax({
			type:"post",
			contentType: "application/json; charset=utf-8",
			url:ajaxUrl+'role/queryRole',
			dataType:'json',
			success:function(jo){
				var roleList='';
				$.each(jo, function(i,item) {
					roleList+='<option class="RoleName" roleid="'+item.roleId+'">'+item.roleName+'</option>';
				})
				$('.RoleInp').html(roleList);
			}

		});
		
		
    });
	$('#newAdd').on('click','#addUserCofirm',function(e){
		e.preventDefault();
		var userJ={};
		userJ.loginName=$.trim($('.AccountInp').val());
		userJ.password=$.trim($('.PwdInp').val());
		userJ.name=$.trim($('.NameInp').val());
		userJ.gender=$('.genderGroup').find('input[type=radio]:checked').attr('gid');
		userJ.phone=$.trim($('.phoneInp').val());
		userJ.email=$.trim($('.emailInp').val());
		userJ.employeeNum=$.trim($('.eplyeNumInp').val());
		userJ.entryDate=$.trim($('#indate').val());
		userJ.roleId=$(".RoleInp").find("option:selected").attr('roleid');
		if(userJ.loginName==''){
			$('.userModalAlt').html('请填写登录名');
			return false;
		}
		if(userJ.password==''){
			$('.userModalAlt').html('请填写密码');
			return false;
		}
		if(userJ.name==''){
			$('.userModalAlt').html('请填写姓名');
			return false;
		};

		if(!phoneCheck(userJ.phone,".userModalAlt")){
			
			return;
		}
		
		if(!isEmail(userJ.email,".userModalAlt")){
			
			return;
		}

		if(userJ.employeeNum==''){
			$('.userModalAlt').html('请填写工号');
			return false;
		};
		if(userJ.entryDate==''){
			$('.userModalAlt').html('请填写入职日期');
			return false;
		};
		$("#newAdd").modal("hide");
		$.ajax({
			type:"post",
			contentType: "application/json; charset=utf-8",
			url:ajaxUrl+'user/addUser',
			data:JSON.stringify(userJ),
			dataType:'json',
			success:function(jo){
				if(jo.status=='success'){
					$("#newAdd").modal("hide");
					userpage();
				}
				
			}

		});
	})
	
	
	//修改
	$('.userList').on('click','.userAmend',function(e){	
		$("#newAdd").modal("toggle");
		$('.userModalAlt').html('');
		$('.userConfirm').attr('id','editUserCofirm');
		e.preventDefault();
		$('.AccountInp-wap,.password-wap').hide();
		$('#workStats').show();
		var trs=$(this).parents('tr');
		loginName=trs.find('.loginName').html();
		var Name=trs.find('.Name').html();
		var gender=trs.find('.gender').attr('gid');
		var isEmployment=trs.find('.isEmployment').attr('epid');
		var phone=trs.find('.phone').html();
		var email=trs.find('.email').html();
		var entryDate=trs.find('.entryDate').html();
		var employeeNum=trs.find('.employeeNum').html();
		var roleId=trs.find('.roleId').attr('roleid');
		$('.NameInp').val(Name);
		$('.genderGroup').find('input[gid='+gender+']').prop('checked',true);
		$('.phoneInp').val(phone);
		$('.emailInp').val(email);
		$('.eplyeNumInp').val(employeeNum);
		$('#workStats').find('input[epid='+isEmployment+']').prop('checked',true);
		$('#indate').val(entryDate);
		//角色列表
		$.ajax({
			type:"post",
			contentType: "application/json; charset=utf-8",
			url:ajaxUrl+'role/queryRole',
			dataType:'json',
			success:function(jo){
				var roleList='';
				$.each(jo, function(i,item) {
					roleList+='<option class="RoleName" roleid="'+item.roleId+'">'+item.roleName+'</option>';
				})
				$('.RoleInp').html(roleList);
				$('.RoleInp').find('option[roleid="'+roleId+'"]').prop('selected',true);
			}

		});
	})
	$('#newAdd').on('click','#editUserCofirm',function(e){
		$("#newAdd").modal("show");
		$('.userModalAlt').html('');
		var editUserJ={};
		editUserJ.name=$('.NameInp').val();
		editUserJ.gender=$('.genderGroup').find('input[type=radio]:checked').attr('gid');
		editUserJ.isEmployment=$('#workStats').find('input[type=radio]:checked').attr('epid');
		editUserJ.phone=$('.phoneInp').val();
		editUserJ.email=$('.emailInp').val();
		editUserJ.entryDate=$('#indate').val();
		editUserJ.roleId=$('.RoleInp').find('option:selected').attr('roleid');
		editUserJ.employeeNum=$('.eplyeNumInp').val();
		editUserJ.loginName=loginName;
		if(editUserJ.name==''){
			$('.userModalAlt').html('请填写员工姓名');
			return;
		};
		if(!phoneCheck(editUserJ.phone,".userModalAlt")){
			
			return;
		}
		
		if(!isEmail(editUserJ.email,".userModalAlt")){
			
			return;
		}
		if(editUserJ.employeeNum==''){
			$('.userModalAlt').html('请填写工号');
			return;
		};
		if(editUserJ.entryDate==''){
			$('.userModalAlt').html('请填写入职日期');
			return;
		};
		$.ajax({
			type:"post",
			contentType: "application/json; charset=utf-8",
			url:ajaxUrl+'user/updateUser',
			data:JSON.stringify(editUserJ),
			dataType:'json',
			success:function(jo){
				if(jo.status=='success'){
					$("#newAdd").modal("hide");
					userpage();
				}
				
			}
		})
	})
    var H=$(window).height()-60;
	$(".wapper").mCustomScrollbar({
		set_height:H,
		scrollButtons:{enable:true},
		theme:"minimal-dark",
		scrollbarPosition:"relative",

	});
	</script>
	</body>
</html>



